var Ie=Object.defineProperty;var Be=(t,n,s)=>n in t?Ie(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var S=(t,n,s)=>Be(t,typeof n!="symbol"?n+"":n,s);import{r as o,j as e,_ as De}from"./index-HOA9EGyr.js";import{L as Ae}from"./lenis-DTHSWqDp.js";function N(t){if(t===0)return"0 Bytes";const n=1024,s=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/Math.pow(n,r)).toFixed(2))+" "+s[r]}const Pe=({file:t,fileQueue:n,currentIndex:s,progress:r,status:a,error:f,onFilesSelect:h,onStart:i,onPause:l,onResume:p,onAbort:c})=>{const[R,T]=o.useState(!1),L=o.useRef(null),v=u=>{u.preventDefault(),u.stopPropagation(),u.type==="dragenter"||u.type==="dragover"?T(!0):u.type==="dragleave"&&T(!1)},j=u=>{if(u.preventDefault(),u.stopPropagation(),T(!1),u.dataTransfer.files&&u.dataTransfer.files.length>0){const y=Array.from(u.dataTransfer.files);h(y)}},J=u=>{if(u.target.files&&u.target.files.length>0){const y=Array.from(u.target.files);h(y)}};return e.jsxs("div",{className:"retro-card",children:[e.jsx("h2",{className:"font-mono text-amber",style:{marginTop:0},children:"SENDER TERMINAL"}),n.length===0?e.jsxs("div",{className:`drop-zone ${R?"active":""}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:j,onClick:()=>{var u;return(u=L.current)==null?void 0:u.click()},children:[e.jsx("p",{className:"font-mono",children:"DROP FILES HERE"}),e.jsx("p",{className:"text-muted",style:{fontSize:"0.9rem",marginTop:"0.5rem"},children:"or click to browse (multiple allowed)"}),e.jsx("input",{ref:L,type:"file",multiple:!0,style:{display:"none"},onChange:J})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"font-mono",style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"0.5rem",opacity:.7},children:["FILE QUEUE (",s+1,"/",n.length,")"]}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto"},children:n.map((u,y)=>e.jsxs("div",{style:{padding:"0.5rem",background:y===s?"rgba(127, 163, 124, 0.2)":"transparent",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[e.jsxs("span",{className:y<s?"text-green":y===s?"text-amber":"text-muted",children:[y<s?"âœ“ ":y===s?"â–º ":"â—‹ ",u.name.length>25?u.name.slice(0,22)+"...":u.name]}),e.jsx("span",{className:"text-muted",style:{fontSize:"0.8rem"},children:N(u.size)})]},y))})]}),t&&e.jsxs("div",{className:"file-info",children:[e.jsxs("div",{children:["CURRENT: ",e.jsx("span",{className:"text-primary",children:t.name})]}),e.jsxs("div",{children:["SIZE: ",e.jsx("span",{className:"text-muted",children:N(t.size)})]})]}),(a==="idle"||a==="error")&&e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{className:"retro-btn primary",onClick:i,children:a==="error"?"RETRY":`SEND ${n.length} FILES`}),e.jsx("button",{className:"retro-btn",onClick:c,children:"CLEAR"})]}),a==="waiting"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-amber blink",children:"WAITING FOR PEER ACCEPT..."}),e.jsx("button",{className:"retro-btn",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:c,children:"CANCEL"})]}),(a==="uploading"||a==="paused")&&r&&e.jsxs("div",{children:[e.jsx("div",{className:"progress-container",children:e.jsx("div",{className:"progress-fill",style:{width:`${r.percent}%`,opacity:a==="paused"?.5:1}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.9rem",marginBottom:"1rem"},children:[e.jsxs("span",{className:"font-mono",children:[r.percent.toFixed(1),"%"]}),e.jsx("span",{className:"font-mono",children:a==="paused"?"PAUSED":`${N(r.speedBps)}/s`}),e.jsxs("span",{className:"text-muted",children:[N(r.bytesSent)," / ",N(r.totalBytes)]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[a==="uploading"?e.jsx("button",{className:"retro-btn",onClick:l,children:"POSTPONE (PAUSE)"}):e.jsx("button",{className:"retro-btn primary",onClick:p,children:"RESUME"}),e.jsx("button",{className:"retro-btn",style:{borderColor:"var(--accent-red)",color:"var(--accent-red)"},onClick:c,children:"CANCEL"})]})]}),f&&e.jsxs("div",{className:"text-red font-mono",style:{marginTop:"1rem"},children:["ERROR: ",f]}),a==="complete"&&s<n.length-1&&e.jsx("div",{className:"text-amber font-mono",style:{marginTop:"1rem"},children:"STARTING NEXT FILE..."}),a==="complete"&&s>=n.length-1&&e.jsxs("div",{className:"text-green font-mono",style:{marginTop:"1rem",textAlign:"center"},children:["âœ“ ALL TRANSFERS COMPLETE",e.jsx("button",{className:"retro-btn",style:{marginLeft:"1rem"},onClick:c,children:"NEW TRANSFER"})]})]})]})},Le=({fileMetadata:t,progress:n,status:s,error:r,onAccept:a,onReject:f,onReset:h})=>!t&&s==="idle"?e.jsxs("div",{className:"retro-card",style:{opacity:.7},children:[e.jsx("h2",{className:"font-mono text-muted",style:{marginTop:0},children:"RECEIVER TERMINAL"}),e.jsx("div",{className:"drop-zone",style:{borderStyle:"solid",borderColor:"#333",cursor:"default"},children:e.jsx("p",{className:"text-muted",children:"WAITING FOR INCOMING SIGNALS..."})})]}):e.jsxs("div",{className:"retro-card",children:[e.jsx("h2",{className:"font-mono text-blue",style:{marginTop:0},children:"RECEIVER TERMINAL"}),t&&e.jsxs("div",{className:"font-mono",style:{marginBottom:"1rem"},children:[e.jsx("div",{className:"text-amber",children:"INCOMING TRANSMISSION DETECTED"}),e.jsx("br",{}),e.jsxs("div",{children:["FILE: ",e.jsx("span",{className:"text-primary",children:t.name})]}),e.jsxs("div",{children:["SIZE: ",e.jsx("span",{className:"text-muted",children:N(t.size)})]}),e.jsxs("div",{children:["TYPE: ",e.jsx("span",{className:"text-muted",children:t.mimeType})]})]}),s==="offering"&&e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem"},children:[e.jsx("button",{className:"retro-btn primary",onClick:a,children:"ACCEPT DATA"}),e.jsx("button",{className:"retro-btn",onClick:f,children:"REJECT"})]}),(s==="receiving"||s==="complete"||s==="finalizing")&&n&&e.jsxs("div",{children:[e.jsx("div",{className:"progress-container",children:e.jsx("div",{className:"progress-fill",style:{width:`${n.percent}%`}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.9rem"},children:[e.jsxs("span",{className:"font-mono",children:[n.percent.toFixed(1),"%"]}),e.jsxs("span",{className:"font-mono",children:[N(n.speedBps),"/s"]}),e.jsxs("span",{className:"text-muted",children:[N(n.bytesReceived)," / ",N(n.totalBytes)]})]})]}),s==="finalizing"&&e.jsx("div",{className:"text-amber blink",style:{marginTop:"1rem"},children:"ASSEMBLING FILE ON DISK..."}),s==="complete"&&e.jsxs("div",{className:"text-green font-mono",style:{marginTop:"1rem"},children:[e.jsx("div",{children:"âœ“ RECEPTION COMPLETE"}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.7},children:"File saved to Downloads"}),e.jsx("button",{className:"retro-btn",style:{marginTop:"1rem",marginLeft:"0.5rem"},onClick:h,children:"READY FOR NEXT"})]}),r&&e.jsxs("div",{className:"text-red font-mono",style:{marginTop:"1rem"},children:[e.jsxs("div",{children:["ERROR: ",r]}),e.jsx("button",{className:"retro-btn",style:{marginTop:"1rem",borderColor:"var(--accent-red)",color:"var(--accent-red)"},onClick:h,children:"READY FOR NEXT"})]})]});let q=250*1024;const Oe=4*1024*1024,me=1*1024*1024,Ue=()=>{const t=new URLSearchParams(window.location.search),n=t.get("ws");if(n)return n.startsWith("ws://")||n.startsWith("wss://")?n:n.includes("devtunnels.ms")?`wss://${n}`:`ws://${n}:${t.get("port")||"8080"}`;const s=window.location.hostname,r=window.location.protocol==="https:"?"wss:":"ws:";return s.includes("onrender.com")?`${r}//${s}`:`${r}//${s}:8080`},Fe=[{urls:"stun:stun.l.google.com:19302"}];let g=null,G=0;const ze=10,Me=2e3;let $=null;const ue=t=>{$=t,g&&g.readyState===WebSocket.OPEN&&z({type:"join",room:t})};let K=null;const _e=t=>{K=t},he=()=>new Promise((t,n)=>{if(g&&(g.readyState===WebSocket.OPEN||g.readyState===WebSocket.CONNECTING)){t(g);return}const s=Ue();g=new WebSocket(s),g.onopen=()=>{G=0,$&&z({type:"join",room:$}),t(g)},g.onmessage=r=>{try{const a=JSON.parse(r.data);K&&K(a)}catch{}},g.onclose=r=>{$&&r.code!==1e3&&setTimeout(()=>We(),Me)},g.onerror=r=>{G===0&&n(r)}});async function We(){if(!(G>=ze)){G++;try{await he()}catch{}}}const z=t=>{g&&g.readyState===WebSocket.OPEN&&g.send(JSON.stringify(t))},fe=()=>g;let A=null,w=null,Y=null,X=null,b=null,U=null;const $e=5e3,pe=(t,n,s)=>{Y=t,X=n,b=s},Ge=()=>A,He=()=>w,E=t=>A&&A.readyState==="open"?(A.send(JSON.stringify(t)),!0):!1,Q=t=>{if(w&&w.readyState==="open")try{return w.send(t),!0}catch{return!1}return!1},ae=t=>{A=t,t.onopen=()=>{b&&b("control",!0),Je()},t.onclose=()=>{Ve(),b&&b("control",!1)},t.onmessage=n=>{try{const s=JSON.parse(n.data);Y&&Y(s),s.type==="ping"&&E({type:"pong"})}catch{}}},oe=t=>{w=t,t.binaryType="arraybuffer",t.bufferedAmountLowThreshold=me,t.onopen=()=>{b&&b("data",!0)},t.onclose=()=>{b&&b("data",!1)},t.onmessage=n=>{n.data instanceof ArrayBuffer&&X&&X(n.data)}};function Je(){U&&clearInterval(U),U=setInterval(()=>{A&&A.readyState==="open"&&E({type:"ping"})},$e)}function Ve(){U&&(clearInterval(U),U=null)}const Z=()=>new Promise(t=>{if(!w||w.readyState!=="open"){t();return}if(w.bufferedAmount<=me){t();return}const n=()=>{w&&w.removeEventListener("bufferedamountlow",n),t()};w.addEventListener("bufferedamountlow",n),setTimeout(()=>{w&&w.removeEventListener("bufferedamountlow",n),t()},500)}),qe=Object.freeze(Object.defineProperty({__proto__:null,getControlChannel:Ge,getDataChannel:He,registerDataHandlers:pe,sendControl:E,sendData:Q,setupControlChannel:ae,setupDataChannel:oe,waitForDrain:Z},Symbol.toStringTag,{value:"Module"}));let m=null,ee=null,te=null;const Ke=t=>{te=t},ne=(t,n)=>(m&&m.close(),ee=t,m=new RTCPeerConnection({iceServers:Fe}),m.onicecandidate=s=>{const r=fe();s.candidate&&r&&r.readyState===WebSocket.OPEN&&z({type:"ice-candidate",candidate:s.candidate,room:t})},m.onconnectionstatechange=()=>{te&&m&&te(m.connectionState)},m.ondatachannel=s=>{s.channel.label==="control"?ae(s.channel):s.channel.label==="data"&&oe(s.channel)},n&&Ye(m),m);function Ye(t){const n=t.createDataChannel("control",{ordered:!0});ae(n);const s=t.createDataChannel("data",{ordered:!0});oe(s)}let se=[];async function ye(){if(!(!m||!m.remoteDescription))for(;se.length>0;){const t=se.shift();if(t)try{await m.addIceCandidate(new RTCIceCandidate(t))}catch{}}}const Xe=async t=>{if(m||ne(ee,!1),!!m){m.signalingState!=="stable"&&m.signalingState;try{await m.setRemoteDescription(new RTCSessionDescription(t)),await ye();const n=await m.createAnswer();await m.setLocalDescription(n),z({type:"answer",answer:n,room:ee})}catch{}}},Qe=async t=>{if(m&&m.signalingState!=="stable")try{await m.setRemoteDescription(new RTCSessionDescription(t)),await ye()}catch{}},Ze=async t=>{if(m){if(!m.remoteDescription){se.push(t);return}try{await m.addIceCandidate(new RTCIceCandidate(t))}catch{}}},et=t=>{const[n,s]=o.useState("Connecting..."),[r,a]=o.useState("new");o.useEffect(()=>{const l=fe();if(l){s(l.readyState===WebSocket.OPEN?"Connected":"Disconnected");const p=setInterval(()=>{s(l.readyState===WebSocket.OPEN?"Connected":"Connecting...")},2e3);return()=>clearInterval(p)}},[]),o.useEffect(()=>{Ke(l=>{a(l)})},[]);const f=()=>r==="connected"?"status-dot connected":r==="failed"||r==="closed"?"status-dot error":r==="connecting"?"status-dot connecting":"status-dot waiting",h=()=>r==="connected"?"ðŸ”’ SECURE CONNECTION":r==="connecting"?"ðŸ”„ NEGOTIATING...":r==="disconnected"?"âŒ PEER DISCONNECTED":"â³ WAITING FOR PEER",i=()=>r==="connected"?"status-connected":r==="connecting"?"status-waiting":"";return e.jsxs("div",{className:"status-bar",children:[e.jsxs("div",{className:"status-left",children:[e.jsx("span",{className:f()}),e.jsx("span",{className:`status-text ${i()}`,children:h()})]}),e.jsx("div",{className:"status-right",children:e.jsxs("span",{className:n==="Connected"?"text-green":"text-amber",children:["â— ",n.toUpperCase()]})})]})},Se=()=>{const[t,n]=o.useState(!1),[s,r]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("footer",{className:"app-footer",children:e.jsxs("div",{className:"footer-content",children:[e.jsxs("div",{className:"developer-info",onClick:()=>r(!0),style:{cursor:"pointer"},children:[e.jsx("img",{src:"/aiks1.jpg",alt:"Developer",className:"developer-avatar"}),e.jsx("span",{className:"developer-name",children:"AIKS"})]}),e.jsx("button",{className:"btn-donate",onClick:()=>n(!0),children:"ðŸ’Œ Thank Me."})]})}),s&&e.jsx("div",{className:"modal-overlay",onClick:()=>r(!1),children:e.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:()=>r(!1),children:"Ã—"}),e.jsx("img",{src:"/aiks1.jpg",alt:"Developer",className:"donation-image",style:{borderRadius:"50%",width:"300px",height:"300px",objectFit:"cover"}})]})}),t&&e.jsx("div",{className:"modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"modal-close",onClick:()=>n(!1),children:"Ã—"}),e.jsx("img",{src:"/donate.png",alt:"Donation QR",className:"donation-image"})]})})]})};class tt{constructor(n,s,r){S(this,"file");S(this,"onProgress");S(this,"onStatus");S(this,"aborted",!1);S(this,"paused",!1);S(this,"totalBytesSent",0);S(this,"lastSpeedUpdate",0);S(this,"lastBytesForSpeed",0);S(this,"lastUIUpdate",0);S(this,"currentSpeed",0);this.file=n,this.onProgress=s,this.onStatus=r}abort(){this.aborted=!0}pause(){this.paused=!0}resume(){this.paused=!1}async start(){this.onStatus("uploading"),this.totalBytesSent=0,this.lastSpeedUpdate=Date.now(),this.lastBytesForSpeed=0,this.lastUIUpdate=0;const n=Math.ceil(this.file.size/q);try{if("wakeLock"in navigator)try{await navigator.wakeLock.request("screen")}catch{}for(let s=0;s<n;s++){if(this.aborted)throw new Error("Aborted");for(;this.paused;){if(this.aborted)throw new Error("Aborted");await new Promise(c=>setTimeout(c,100)),this.lastSpeedUpdate=Date.now(),this.lastBytesForSpeed=this.totalBytesSent,this.updateStats()}const r=s*q,a=Math.min(r+q,this.file.size),h=await this.file.slice(r,a).arrayBuffer(),i=new ArrayBuffer(4+h.byteLength);new DataView(i).setUint32(0,s,!0),new Uint8Array(i,4).set(new Uint8Array(h));const l=await De(()=>Promise.resolve().then(()=>qe),void 0).then(c=>c.getDataChannel());if(l&&l.readyState==="open"){for(;l.bufferedAmount>Oe;)if(await Z(),this.aborted)throw new Error("Aborted")}else if(l&&l.readyState!=="open")throw new Error("Data channel closed");let p=Q(i);if(!p&&(await Z(),p=Q(i),!p))throw new Error("Data channel closed or failed");this.totalBytesSent+=h.byteLength,this.updateStats()}this.updateStats(!0),this.onStatus("complete")}catch(s){this.onStatus("error",s.message)}}updateStats(n=!1){const s=Date.now();if(n||s-this.lastUIUpdate>100||this.totalBytesSent>=this.file.size||this.paused){this.lastUIUpdate=s;let r=this.currentSpeed;const a=(s-this.lastSpeedUpdate)/1e3;this.paused?(r=0,this.currentSpeed=0):a>=.5?(r=(this.totalBytesSent-this.lastBytesForSpeed)/a,this.currentSpeed=r,this.lastSpeedUpdate=s,this.lastBytesForSpeed=this.totalBytesSent):this.lastBytesForSpeed===0&&a>.1&&(r=this.totalBytesSent/a,this.currentSpeed=r),this.onProgress({bytesSent:this.totalBytesSent,totalBytes:this.file.size,percent:this.totalBytesSent/this.file.size*100,speedBps:r})}}}const nt="FileTransferDB",I="chunks";let P=null;const st=()=>new Promise((t,n)=>{const s=indexedDB.open(nt,1);s.onupgradeneeded=r=>{const a=r.target.result;a.objectStoreNames.contains(I)||a.createObjectStore(I,{keyPath:["fileName","chunkIndex"]})},s.onsuccess=r=>{P=r.target.result,t()},s.onerror=r=>n(r)}),rt=(t,n,s)=>P?new Promise((r,a)=>{const f=P.transaction(I,"readwrite");f.objectStore(I).put({fileName:t,chunkIndex:n,data:s}),f.oncomplete=()=>r(),f.onerror=()=>a(f.error)}):Promise.reject("DB not initialized"),at=t=>P?new Promise((n,s)=>{const a=P.transaction(I,"readonly").objectStore(I),f=IDBKeyRange.bound([t,0],[t,1/0]),h=a.openCursor(f),i=[];h.onsuccess=l=>{const p=l.target.result;p?(i.push(new Blob([p.value.data])),p.continue()):n(i)},h.onerror=()=>s(h.error)}):Promise.reject("DB not initialized"),ot=t=>P?new Promise((n,s)=>{const a=P.transaction(I,"readwrite").objectStore(I),f=IDBKeyRange.bound([t,0],[t,1/0]),h=a.delete(f);h.onsuccess=()=>n(),h.onerror=()=>s(h.error)}):Promise.reject("DB not initialized"),H=[];let ge=0,re=!1;const it=t=>{H.push(t),ge+=t.data.byteLength,re||lt()};async function lt(){for(re=!0;H.length>0;){const t=H.shift();if(t){ge-=t.data.byteLength;try{await rt(t.fileName,t.chunkIndex,t.data)}catch{}}}re=!1}class ct{constructor(n,s,r){S(this,"metadata");S(this,"onProgress");S(this,"onStatus");S(this,"totalBytesReceived",0);S(this,"receivedChunkCount",0);S(this,"lastSpeedUpdate",0);S(this,"lastBytesForSpeed",0);S(this,"lastUIUpdate",0);S(this,"currentSpeed",0);this.metadata=n,this.onProgress=s,this.onStatus=r,this.lastSpeedUpdate=Date.now()}handleChunk(n){const r=new DataView(n).getUint32(0,!0),a=n.slice(4);this.totalBytesReceived+=a.byteLength,this.receivedChunkCount++,this.updateStats(),it({fileName:this.metadata.name,chunkIndex:r,data:a}),this.receivedChunkCount%40===0&&E({type:"ack",chunkIndex:r,bytesReceived:this.totalBytesReceived}),this.totalBytesReceived>=this.metadata.size&&this.finalize()}updateStats(){const n=Date.now();if(n-this.lastUIUpdate>100||this.totalBytesReceived>=this.metadata.size){this.lastUIUpdate=n;let s=this.currentSpeed;const r=(n-this.lastSpeedUpdate)/1e3;r>=.5?(s=(this.totalBytesReceived-this.lastBytesForSpeed)/r,this.currentSpeed=s,this.lastSpeedUpdate=n,this.lastBytesForSpeed=this.totalBytesReceived):this.lastBytesForSpeed===0&&r>.1&&(s=this.totalBytesReceived/r,this.currentSpeed=s),this.onProgress({bytesReceived:this.totalBytesReceived,totalBytes:this.metadata.size,percent:this.totalBytesReceived/this.metadata.size*100,speedBps:s})}}async finalize(){for(this.onStatus("receiving","finalizing");H.length>0;)await new Promise(n=>setTimeout(n,50));try{const n=await at(this.metadata.name),s=new Blob(n,{type:this.metadata.mimeType});await ot(this.metadata.name),this.onStatus("complete",s),E({type:"file-complete",bytesReceived:this.totalBytesReceived})}catch(n){this.onStatus("error",n.message)}}}const dt=({roomId:t,onLeave:n})=>{const[s,r]=o.useState("idle"),[a,f]=o.useState(!1),[h,i]=o.useState(null),[l,p]=o.useState([]),[c,R]=o.useState(0),[T,L]=o.useState(null),[v,j]=o.useState("idle"),[J,u]=o.useState(null),y=o.useRef(null),[M,_]=o.useState(null),[xe,V]=o.useState(null),[ve,C]=o.useState("idle"),[we,F]=o.useState(null),O=o.useRef(null),B=o.useRef(s),W=o.useRef(v);o.useEffect(()=>{B.current=s},[s]),o.useEffect(()=>{W.current=v},[v]);const je=()=>{navigator.clipboard.writeText(t),f(!0),setTimeout(()=>f(!1),2e3)},ie=o.useCallback((d,x)=>{},[]),le=o.useCallback(d=>{switch(d.type){case"file-request":if(B.current==="sender"&&W.current!=="idle"&&W.current!=="complete")return;r("receiver"),_({name:d.name,size:d.size,mimeType:d.mimeType||"application/octet-stream"}),C("offering"),F(null),V(null);break;case"file-accept":B.current==="sender"&&W.current==="waiting"&&y.current&&y.current.start();break;case"file-reject":B.current==="sender"&&(j("error"),u("Peer rejected file transfer."));break;case"ack":break;case"file-complete":B.current==="sender"&&console.log("Receiver confirmed file-complete, ready for next file");break;case"cancel":B.current==="receiver"&&(C("error"),F("Transfer cancelled by sender."),O.current);break}},[]),ce=o.useCallback(d=>{O.current&&B.current==="receiver"&&O.current.handleChunk(d)},[]);o.useEffect(()=>{st().catch(()=>{}),pe(le,ce,ie)},[le,ce,ie]);const Ce=d=>{r("sender"),p(d),R(0),i(d[0]),j("idle"),u(null),L(null)},de=d=>{const x=d||h;x&&(y.current=new tt(x,k=>L(k),(k,D)=>{k==="uploading"&&j("uploading"),k==="complete"&&j("complete"),k==="error"&&(j("error"),u(D||"Unknown error"))}),j("waiting"),E({type:"file-request",name:x.name,size:x.size,mimeType:x.type}))};o.useEffect(()=>{if(v==="complete"&&c<l.length-1){const d=c+1;R(d),i(l[d]),j("idle"),L(null),setTimeout(()=>{de(l[d])},1e3)}},[v,c,l]);const Ne=()=>{y.current&&y.current.abort(),s==="sender"&&(v==="uploading"||v==="waiting"||v==="paused")&&E({type:"cancel"}),r("idle"),i(null),p([]),R(0)};o.useEffect(()=>{const d=x=>{t&&(x.preventDefault(),x.returnValue="")};return window.addEventListener("beforeunload",d),()=>window.removeEventListener("beforeunload",d)},[t]);const be=()=>{M&&(C("receiving"),O.current=new ct(M,d=>V(d),(d,x)=>{d==="receiving"&&x==="finalizing"?C("finalizing"):d==="receiving"&&C("receiving"),d==="complete"&&(C("complete"),Re(x,M.name),setTimeout(()=>{r("idle"),_(null),C("idle"),F(null),V(null),O.current=null},500)),d==="error"&&(C("error"),F(x))}),E({type:"file-accept"}))},Ee=()=>{E({type:"file-reject"}),r("idle"),_(null)},Re=(d,x)=>{const k=URL.createObjectURL(d),D=document.createElement("a");D.href=k,D.download=x,document.body.appendChild(D),D.click(),document.body.removeChild(D),setTimeout(()=>URL.revokeObjectURL(k),1e3)},Te=()=>{r("idle"),_(null),C("idle"),F(null),ke(null)},ke=d=>{O.current=d};return e.jsx("div",{className:"app-container",children:e.jsxs("div",{style:{maxWidth:"550px",width:"100%"},children:[e.jsxs("div",{className:"retro-card",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",padding:"1.2rem 1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("div",{className:"font-mono text-muted",style:{fontSize:"0.85rem"},children:"ROOM"}),e.jsx("div",{className:"font-mono room-code",children:t}),e.jsx("button",{className:"retro-btn",style:{padding:"0.5rem 1rem",fontSize:"0.75rem"},onClick:je,children:a?"âœ“ COPIED":"COPY"})]}),e.jsx("button",{className:"retro-btn",onClick:n,style:{borderColor:"var(--accent-red)",color:"var(--accent-red)",padding:"0.5rem 1rem",fontSize:"0.75rem"},children:"LEAVE"})]}),e.jsx(et,{roomId:t}),e.jsx("div",{style:{marginTop:"2rem"},children:s==="receiver"?e.jsx(Le,{fileMetadata:M,progress:xe,status:ve,error:we,onAccept:be,onReject:Ee,onReset:Te}):e.jsx(Pe,{file:h,fileQueue:l,currentIndex:c,progress:T,status:v,error:J,onFilesSelect:Ce,onStart:()=>de(),onPause:()=>{y.current&&y.current.pause(),j("paused")},onResume:()=>{y.current&&y.current.resume(),j("uploading")},onAbort:Ne})}),e.jsx(Se,{})]})})},ut=({onJoin:t,onCreate:n})=>{const[s,r]=o.useState(""),a=()=>{s.length>0&&t(s.toUpperCase())};return e.jsxs("div",{className:"app-container",children:[e.jsx("h1",{style:{fontFamily:"var(--font-heading)",fontSize:"3rem",color:"var(--text-primary)",margin:0,textAlign:"center",marginBottom:"2rem"},children:"POJO FILES"}),e.jsx("div",{className:"retro-card",style:{width:"100%",maxWidth:"400px"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-mono text-muted",style:{fontSize:"0.9rem"},children:"ENTER ROOM CODE"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("input",{className:"retro-input",value:s,onChange:f=>r(f.target.value.toUpperCase()),placeholder:"A7X92B",maxLength:6,style:{textAlign:"center",letterSpacing:"0.2em",fontSize:"1.2rem",fontWeight:"bold"}}),e.jsx("button",{className:"retro-btn",onClick:a,disabled:s.length<3,children:"JOIN"})]})]}),e.jsx("div",{style:{textAlign:"center",opacity:.5,fontSize:"0.8rem"},className:"font-mono",children:"â€” OR â€”"}),e.jsx("button",{className:"retro-btn primary",onClick:n,children:"CREATE NEW ROOM"})]})}),e.jsx(Se,{})]})};function mt(){const[t,n]=o.useState(null);o.useEffect(()=>{const i=new Ae({duration:1.2,easing:p=>Math.min(1,1.001-Math.pow(2,-10*p))});function l(p){i.raf(p),requestAnimationFrame(l)}return requestAnimationFrame(l),window.scrollTo(0,0),()=>{i.destroy()}},[]);const s=()=>Math.random().toString(36).substring(2,8).toUpperCase(),r=async(i,l)=>{n(i),ue(i);const p=new URL(window.location.href);p.searchParams.set("room",i),window.history.pushState({},"",p.toString());try{await he(),_e(async c=>{if(c.type==="joined"&&c.isInitiator,c.type==="peer-joined"){if(l){const R=ne(i,!0),T=await R.createOffer();await R.setLocalDescription(T),z({type:"offer",offer:T,room:i})}}else c.type==="room-state"?c.peerCount&&c.peerCount>1:c.type==="offer"?l||(ne(i,!1),c.offer&&await Xe(c.offer)):c.type==="answer"?l&&c.answer&&await Qe(c.answer):c.type==="ice-candidate"&&c.candidate&&await Ze(c.candidate)})}catch{}};o.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("room");if(l){const p=sessionStorage.getItem("isInitiator")==="true";r(l,p)}},[]);const a=()=>{const i=s();sessionStorage.setItem("isInitiator","true"),r(i,!0)},f=i=>{sessionStorage.setItem("isInitiator","false"),r(i,!1)},h=()=>{n(null),sessionStorage.removeItem("isInitiator"),ue("");const i=new URL(window.location.href);i.searchParams.delete("room"),window.history.pushState({},"",i.toString()),window.location.reload()};return t?e.jsx(dt,{roomId:t,onLeave:h}):e.jsx(ut,{onJoin:f,onCreate:a})}const yt=()=>e.jsx(mt,{});export{yt as default};
